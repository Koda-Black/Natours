{"mappings":"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","sources":["public/js/index.js","public/js/leaflet.js","public/js/login.js","public/js/alerts.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["/*eslint-disable*/\n\nimport '@babel/polyfill';\nimport { displayMap } from './leaflet';\nimport { login, logout } from './login';\nimport { updateSettings } from './updateSettings';\nimport { bookTour } from './stripe';\n\n// DOM ELEMENTS\nconst leafletMap = document.getElementById('map');\nconst loginForm = document.querySelector('.form--login');\nconst logOutBtn = document.querySelector('.nav__el--logout');\nconst userDataForm = document.querySelector('.form-user-data');\nconst userPasswordForm = document.querySelector('.form-user-password');\nconst bookBtn = document.getElementById('book-tour');\n\n// DELEGATION\nif (leafletMap) {\n  const locations = JSON.parse(leafletMap.dataset.locations);\n  displayMap(locations);\n}\n\nif (loginForm) {\n  loginForm.addEventListener('submit', (e) => {\n    // VALUES\n    const email = document.getElementById('email').value;\n    const password = document.getElementById('password').value;\n    e.preventDefault();\n    login(email, password);\n  });\n}\n\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\n\nif (userDataForm) {\n  userDataForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n\n    const form = new FormData();\n    form.append('name', document.getElementById('name').value);\n    form.append('email', document.getElementById('email').value);\n    form.append('photo', document.getElementById('photo').files[0]);\n    console.log(form);\n\n    updateSettings(form, 'data');\n  });\n}\n\nif (userPasswordForm) {\n  userPasswordForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n\n    document.querySelector('.btn--save-password').textContent = 'Updating...';\n\n    const passwordCurrent = document.getElementById('password-current').value;\n    const password = document.getElementById('password').value;\n    const passwordConfirm = document.getElementById('password-confirm').value;\n    await updateSettings(\n      { passwordCurrent, password, passwordConfirm },\n      'password',\n    );\n\n    document.querySelector('.btn--save-password').textContent = 'Save password';\n    document.getElementById('password-current').value = '';\n    document.getElementById('password').value = '';\n    document.getElementById('password-confirm').value = '';\n  });\n}\n\nif (bookBtn) {\n  bookBtn.addEventListener('click', (e) => {\n    e.target.textContent = 'Processing...';\n    const { tourId } = e.target.dataset;\n    bookTour(tourId);\n  });\n}\n","/*eslint-disable*/\n\nexport const displayMap = (locations) => {\n  var map = L.map('map', { zoomControl: false });\n\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    attribution:\n      '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n    crossOrigin: '',\n  }).addTo(map);\n\n  const points = [];\n  locations.forEach((loc) => {\n    // // Create marker for each location\n    // const el = document.createElement('div');\n    // el.className = 'marker';\n    // new L.marker({\n    //   element: el,\n    //   anchor: 'bottom',\n    // });\n    // Add marker for each location\n    points.push([loc.coordinates[1], loc.coordinates[0]]);\n    L.marker([loc.coordinates[1], loc.coordinates[0]])\n      .addTo(map)\n      .bindPopup(`<p>Day ${loc.day}: ${loc.description}</p>`, {\n        autoClose: false,\n      })\n      .openPopup();\n  });\n\n  // Extend map bounds to include current location\n  const bounds = L.latLngBounds(points).pad(0.5);\n  map.fitBounds(bounds);\n\n  map.scrollWheelZoom.disable();\n\n  // To avoid map dragging\n  var map =\n    map != null\n      ? map\n      : L.map('map', {\n          zoomControl: false,\n          center: [51.505, -0.09],\n          zoom: 13,\n          dragging: false,\n        });\n};\n","/*eslint-disable*/\nimport axios from 'axios';\nimport { showAlert } from './alerts';\n\nexport const login = async (email, password) => {\n  try {\n    const res = await axios({\n      method: 'POST',\n      url: '/api/v1/users/login',\n      data: {\n        email,\n        password,\n      },\n    });\n\n    if (res.data.status === 'success') {\n      showAlert('success', 'Logged in successfully!');\n      window.setTimeout(() => {\n        location.assign('/');\n      }, 1000);\n    }\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n\nexport const logout = async () => {\n  try {\n    const res = await axios({\n      method: 'GET',\n      url: '/api/v1/users/logout',\n    });\n    if (res.data.status === 'success') location.reload(true);\n  } catch (err) {\n    showAlert('error', 'Error Logging out...Try again!');\n  }\n};\n","/*eslint-disable*/\n\nexport const hideAlert = () => {\n  const el = document.querySelector('.type');\n  if (el) el.parentElement.removeChild(el);\n};\n\n// type is either 'success' or 'error'\nexport const showAlert = (type, msg) => {\n  hideAlert();\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\n  window.setTimeout(hideAlert, 5000);\n};\n","/*eslint-disable*/\n\nimport axios from 'axios';\nimport { showAlert } from '../js/alerts';\n\n// type is either password or data\nexport const updateSettings = async (data, type) => {\n  try {\n    const url =\n      type === 'password'\n        ? '/api/v1/users/updateMyPassword'\n        : '/api/v1/users/updateMe';\n\n    const res = await axios({\n      method: 'PATCH',\n      url,\n      data,\n    });\n\n    if (res.data.status === 'success') {\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\n    }\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n","/*eslint-disable */\nimport axios from 'axios';\nimport { showAlert } from './alerts'; // assuming you have a function to show alerts\nconst stripe = Stripe(\n  'pk_test_51NwENrG2DlmKh6ZVYQyccLROiUyoiMf73jTF0LOQBCjp5zed7Mxd0BxRQp8WgE8dT0FODln50sgSROiU1oxmOLW1003BohHLs2',\n);\n\nexport const bookTour = async (tourId) => {\n  try {\n    // 1) Get checkout session from API\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\n    console.log(session);\n\n    // 2) Create checkout form + charge credit card\n\n    await stripe.redirectToCheckout({\n      sessionId: session.data.session.id,\n    });\n  } catch (err) {\n    console.log(err);\n    showAlert('error', err);\n    switch (err.type) {\n      case 'StripeCardError':\n        console.log(`A payment error occurred: ${err.message}`);\n        break;\n      case 'StripeInvalidRequestError':\n        console.log('An invalid request occurred.');\n        break;\n      default:\n        console.log('Another problem occurred, maybe unrelated to Stripe.');\n        break;\n    }\n  }\n};\n"],"names":[],"version":3,"file":"app.js.map","sourceRoot":"/"}